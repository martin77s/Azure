{
  "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {

  },
  "variables": {
    "Quote": "'",
    "logAnalytics": "[concat('[parameters(', variables('Quote'), 'logAnalytics', variables('Quote'), ')]')]",
    "resourceName": "[concat('[parameters(', variables('Quote'), 'resourceName', variables('Quote'), ')]')]",
    "resourceDiagName": "[concat('[concat(', 'parameters(', variables('Quote'), 'resourceName', variables('Quote'), ')', ', ', variables('Quote'), '/', variables('Quote'), ', ', variables('Quote'), 'Microsoft.Insights/setByPolicy', variables('Quote'), ')]')]",
    "resourceNameField": "[concat('[field(', variables('Quote'), 'name', variables('Quote'), ')]')]",
    "resourceFullNameField": "[concat('[field(', variables('Quote'), 'fullName', variables('Quote'), ')]')]",
    "location": "[concat('[parameters(', variables('Quote'), 'location', variables('Quote'), ')]')]",
    "locationField": "[concat('[field(', variables('Quote'), 'location', variables('Quote'), ')]')]",
    "policyDescription": "Automatically enable diagnostic settings for Log Analytics"
  },
  "resources": [
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "nic-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [],
      "properties": {
        "displayName": "Apply diagnostic settings for Network Interfaces",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Network/networkInterfaces"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Network/networkInterfaces/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "timeGrain": null,
                              "enabled": true,
                              "retentionPolicy": {
                                "enabled": false,
                                "days": 0
                              }
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "aa-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "nic-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Azure Automation Accounts",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Automation/automationAccounts"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Automation/automationAccounts/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "timeGrain": null,
                              "enabled": true,
                              "retentionPolicy": {
                                "enabled": false,
                                "days": 0
                              }
                            }
                          ],
                          "logs": [
                            {
                              "category": "JobLogs",
                              "enabled": true
                            },
                            {
                              "category": "JobStreams",
                              "enabled": true
                            },
                            {
                              "category": "DscNodeStatus",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "pip-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "aa-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Public IPs",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Network/publicIPAddresses"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Network/publicIPAddresses/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "timeGrain": null,
                              "enabled": true,
                              "retentionPolicy": {
                                "enabled": false,
                                "days": 0
                              }
                            }
                          ],
                          "logs": [
                            {
                              "category": "DDoSProtectionNotifications",
                              "enabled": true
                            },
                            {
                              "category": "DDoSMitigationFlowLogs",
                              "enabled": true
                            },
                            {
                              "category": "DDoSMitigationReports",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "lb-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "pip-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Load Balancers",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Network/loadBalancers"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Network/loadBalancers/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "timeGrain": null,
                              "enabled": true,
                              "retentionPolicy": {
                                "enabled": false,
                                "days": 0
                              }
                            }
                          ],
                          "logs": [
                            {
                              "category": "LoadBalancerAlertEvent",
                              "enabled": true
                            },
                            {
                              "category": "LoadBalancerProbeHealthStatus",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "nsg-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "lb-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Network Security Groups",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Network/networkSecurityGroups"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Network/networkSecurityGroups/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [],
                          "logs": [
                            {
                              "category": "NetworkSecurityGroupEvent",
                              "enabled": true
                            },
                            {
                              "category": "NetworkSecurityGroupRuleCounter",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "kv-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "nsg-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Key Vaults",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.KeyVault/vaults"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.KeyVault/vaults/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "AuditEvent",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "cognitive-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "kv-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Cognitive Services",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.CognitiveServices/accounts"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.CognitiveServices/accounts/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "Audit",
                              "enabled": true
                            },
                            {
                              "category": "RequestResponse",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "dlanalytics-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "cognitive-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Data Lake Analytics",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.DataLakeAnalytics/accounts"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.DataLakeAnalytics/accounts/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "Audit",
                              "enabled": true
                            },
                            {
                              "category": "Requests",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "dlstore-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "dlanalytics-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Data Lake Storage",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.DataLakeStore/accounts"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.DataLakeStore/accounts/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "Audit",
                              "enabled": true
                            },
                            {
                              "category": "Requests",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "eventHub-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "dlstore-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Event Hub Namespaces",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.EventHub/namespaces"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.EventHub/namespaces/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "ArchiveLogs",
                              "enabled": true
                            },
                            {
                              "category": "OperationalLogs",
                              "enabled": true
                            },
                            {
                              "category": "AutoScaleLogs",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "iotHub-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "eventHub-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for IoT Hubs",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Devices/IotHubs"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Devices/IotHubs/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "Connections",
                              "enabled": true
                            },
                            {
                              "category": "DeviceTelemetry",
                              "enabled": true
                            },
                            {
                              "category": "C2DCommands",
                              "enabled": true
                            },
                            {
                              "category": "DeviceIdentityOperations",
                              "enabled": true
                            },
                            {
                              "category": "FileUploadOperations",
                              "enabled": true
                            },
                            {
                              "category": "Routes",
                              "enabled": true
                            },
                            {
                              "category": "D2CTwinOperations",
                              "enabled": true
                            },
                            {
                              "category": "C2DTwinOperations",
                              "enabled": true
                            },
                            {
                              "category": "TwinQueries",
                              "enabled": true
                            },
                            {
                              "category": "JobsOperations",
                              "enabled": true
                            },
                            {
                              "category": "DirectMethods",
                              "enabled": true
                            },
                            {
                              "category": "E2EDiagnostics",
                              "enabled": true
                            },
                            {
                              "category": "Configurations",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "logicApps-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "iotHub-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Logic Apps workflows",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Logic/workflows"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Logic/workflows/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "WorkflowRuntime",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "logicApps-Accounts-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "logicApps-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Logic Apps Integration Accounts",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Logic/integrationAccounts"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Logic/integrationAccounts/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [],
                          "logs": [
                            {
                              "category": "IntegrationAccountTrackingEvents",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "recoveryVault-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "logicApps-Accounts-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Recovery Vaults",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.RecoveryServices/vaults"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.RecoveryServices/vaults/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [],
                          "logs": [
                            {
                              "category": "AzureBackupReport",
                              "enabled": true
                            },
                            {
                              "category": "AzureSiteRecoveryJobs",
                              "enabled": true
                            },
                            {
                              "category": "AzureSiteRecoveryEvents",
                              "enabled": true
                            },
                            {
                              "category": "AzureSiteRecoveryReplicatedItems",
                              "enabled": true
                            },
                            {
                              "category": "AzureSiteRecoveryReplicationStats",
                              "enabled": true
                            },
                            {
                              "category": "AzureSiteRecoveryRecoveryPoints",
                              "enabled": true
                            },
                            {
                              "category": "AzureSiteRecoveryReplicationDataUploadRate",
                              "enabled": true
                            },
                            {
                              "category": "AzureSiteRecoveryProtectedDiskDataChurn",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "search-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "recoveryVault-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Search Services",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Search/searchServices"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Search/searchServices/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "OperationLogs",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "serviceBus-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "search-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Service Bus namespaces",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.ServiceBus/namespaces"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.ServiceBus/namespaces/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "OperationalLogs",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "sqlDB-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "serviceBus-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for SQL Databases",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Sql/servers/databases"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Sql/servers/databases/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "SQLInsights",
                              "enabled": true
                            },
                            {
                              "category": "AutomaticTuning",
                              "enabled": true
                            },
                            {
                              "category": "QueryStoreRuntimeStatistics",
                              "enabled": true
                            },
                            {
                              "category": "QueryStoreWaitStatistics",
                              "enabled": true
                            },
                            {
                              "category": "Errors",
                              "enabled": true
                            },
                            {
                              "category": "DatabaseWaitStatistics",
                              "enabled": true
                            },
                            {
                              "category": "Timeouts",
                              "enabled": true
                            },
                            {
                              "category": "Blocks",
                              "enabled": true
                            },
                            {
                              "category": "Deadlocks",
                              "enabled": true
                            },
                            {
                              "category": "Audit",
                              "enabled": true
                            },
                            {
                              "category": "SQLSecurityAuditEvents",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceFullNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "sqlElasticPool-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "sqlDB-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for SQL Elastic Pools",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Sql/servers/elasticPools"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Sql/servers/elasticPools/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": []
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceFullNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "apiMgmt-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "sqlElasticPool-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for API Management services",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.ApiManagement/service"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.ApiManagement/service/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "Gateway Requests",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            },
                            {
                              "category": "Capacity",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            },
                            {
                              "category": "EventHub Events",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "GatewayLogs",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "appGw-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "apiMgmt-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Application Gateways",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Network/applicationGateways"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Network/applicationGateways/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "ApplicationGatewayAccessLog",
                              "enabled": true
                            },
                            {
                              "category": "ApplicationGatewayPerformanceLog",
                              "enabled": true
                            },
                            {
                              "category": "ApplicationGatewayFirewallLog",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "batch-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "appGw-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Azure Batch accounts",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Batch/batchAccounts"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Batch/batchAccounts/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "ServiceLog",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "mySQL-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "batch-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for MySQL Databases",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.DBforMySQL/servers"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.DBforMySQL/servers/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "MySqlSlowLogs",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "postgreSQL-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "mySQL-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for PostgreSQL Databases",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.DBforPostgreSQL/servers"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.DBforPostgreSQL/servers/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "PostgreSQLLogs",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "cdnEndpoints-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "postgreSQL-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for CDN Endpoints",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Cdn/profiles/endpoints"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Cdn/profiles/endpoints/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [],
                          "logs": [
                            {
                              "category": "CoreAnalytics",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceFullNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "cosmosDBs-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "cdnEndpoints-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Cosmos DB",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.DocumentDB/databaseAccounts"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.DocumentDB/databaseAccounts/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "Requests",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "DataPlaneRequests",
                              "enabled": true
                            },
                            {
                              "category": "MongoRequests",
                              "enabled": true
                            },
                            {
                              "category": "QueryRuntimeStatistics",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "dataFactory-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "cosmosDBs-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Data Factory",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.DataFactory/factories"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.DataFactory/factories/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "ActivityRuns",
                              "enabled": true
                            },
                            {
                              "category": "PipelineRuns",
                              "enabled": true
                            },
                            {
                              "category": "TriggerRuns",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "firewall-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "dataFactory-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Azure Firewalls",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Network/azureFirewalls"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Network/azureFirewalls/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "AzureFirewallApplicationRule",
                              "enabled": true
                            },
                            {
                              "category": "AzureFirewallNetworkRule",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "powerBIEmbedded-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "firewall-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Power BI Embedded",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.PowerBIDedicated/capacities"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.PowerBIDedicated/capacities/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "Engine",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "streamAnalytics-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "powerBIEmbedded-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Stream Analytics",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.StreamAnalytics/streamingjobs"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.StreamAnalytics/streamingjobs/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "Execution",
                              "enabled": true
                            },
                            {
                              "category": "Authoring",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "expressRoutes-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "streamAnalytics-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Express Routes Circuits",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Network/expressRouteCircuits"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Network/expressRouteCircuits/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "PeeringRouteLog",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "aci-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "expressRoutes-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Azure Container Instances",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.ContainerInstance/containerGroups"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.ContainerInstance/containerGroups/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": []
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "acr-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "aci-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Azure Container Registries",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.ContainerRegistry/registries"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.ContainerRegistry/registries/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": []
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "vnet-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "acr-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Virtual Networks",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Network/virtualNetworks"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Network/virtualNetworks/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [],
                          "logs": [
                            {
                              "category": "VMProtectionAlerts",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "vm-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "vnet-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Virtual Machines",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Compute/virtualMachines"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Compute/virtualMachines/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "enabled": false,
                                "days": 0
                              }
                            }
                          ],
                          "logs": []
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "vmss-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "vm-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Virtual Machine Scale Sets",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Compute/virtualMachineScaleSets"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Compute/virtualMachineScaleSets/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "enabled": false,
                                "days": 0
                              }
                            }
                          ],
                          "logs": []
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "vnetGW-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "vmss-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Virtual Network Gateways",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Network/virtualNetworkGateways"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Network/virtualNetworkGateways/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "GatewayDiagnosticLog",
                              "enabled": true
                            },
                            {
                              "category": "IKEDiagnosticLog",
                              "enabled": true
                            },
                            {
                              "category": "P2SDiagnosticLog",
                              "enabled": true
                            },
                            {
                              "category": "RouteDiagnosticLog",
                              "enabled": true
                            },
                            {
                              "category": "RouteDiagnosticLog",
                              "enabled": true
                            },
                            {
                              "category": "TunnelDiagnosticLog",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "aks-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "vnetGW-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Azure Kubernetes Service",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.ContainerService/managedClusters"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.ContainerService/managedClusters/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "guard",
                              "enabled": true
                            },
                            {
                              "category": "kube-apiserver",
                              "enabled": true
                            },
                            {
                              "category": "kube-controller-manager",
                              "enabled": true
                            },
                            {
                              "category": "kube-scheduler",
                              "enabled": true
                            },
                            {
                              "category": "cluster-autoscaler",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "website-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "aks-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Azure Web Sites",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Web/sites"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Web/sites/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": []
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "analysisService-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "website-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Azure Analysis Services",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.AnalysisServices/servers"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.AnalysisServices/servers/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "Engine",
                              "enabled": true
                            },
                            {
                              "category": "Service",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "eventGridTopic-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "analysisService-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Event Grid Topics",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.EventGrid/topics"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.EventGrid/topics/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": []
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "eventGrid-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "eventGridTopic-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Event Grid Subscriptions",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.EventGrid/eventSubscriptions"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.EventGrid/eventSubscriptions/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": []
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "hdInsight-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "eventGrid-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for HDInsight",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.HDInsight/clusters"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.HDInsight/clusters/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": []
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "redisCache-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "hdInsight-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Redis Cache",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Cache/redis"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Cache/redis/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": []
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "relay-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "redisCache-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Azure Relay",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Relay/namespaces"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Relay/namespaces/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": []
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "signalR-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "relay-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for SignalR",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.SignalRService/SignalR"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.SignalRService/SignalR/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": []
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "trafficManager-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "signalR-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Azure Traffic Manager",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.Network/trafficManagerProfiles"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.Network/trafficManagerProfiles/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [
                            {
                              "category": "ProbeHealthStatusEvents",
                              "enabled": true
                            }
                          ]
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policyDefinitions",
      "name": "timeSeriesInsights-diag-policy",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "trafficManager-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for Time Series Insights",
        "description": "[variables('policyDescription')]",
        "metadata": {
          "category": "DiagSettings"
        },
        "mode": "all",
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyRule": {
          "if": {
            "field": "type",
            "equals": "Microsoft.TimeSeriesInsights/environments"
          },
          "then": {
            "effect": "deployIfNotExists",
            "details": {
              "type": "Microsoft.Insights/diagnosticSettings",
              "name": "setByPolicy",
              "roleDefinitionIds": [
                "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
              ],
              "deployment": {
                "properties": {
                  "mode": "incremental",
                  "template": {
                    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                      "resourceName": {
                        "type": "string"
                      },
                      "logAnalytics": {
                        "type": "string"
                      },
                      "location": {
                        "type": "string"
                      }
                    },
                    "variables": {},
                    "resources": [
                      {
                        "type": "Microsoft.TimeSeriesInsights/environments/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [
                            {
                              "category": "AllMetrics",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": []
                        }
                      }
                    ],
                    "outputs": {}
                  },
                  "parameters": {
                    "logAnalytics": {
                      "value": "[variables('logAnalytics')]"
                    },
                    "location": {
                      "value": "[variables('locationField')]"
                    },
                    "resourceName": {
                      "value": "[variables('resourceNameField')]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Authorization/policySetDefinitions",
      "name": "Diag-Settings-Initiative",
      "apiVersion": "2018-05-01",
      "dependsOn": [
        "timeSeriesInsights-diag-policy"
      ],
      "properties": {
        "displayName": "Apply diagnostic settings for applicable resources",
        "description": "This initiative configures application Azure resources to forward diagnostic logs and metrics to an Azure Log Analytics workspace.",
        "metadata": {
          "category": "DiagSettings"
        },
        "parameters": {
          "logAnalytics": {
            "type": "string",
            "metadata": {
              "displayName": "Log Analyitcs workspace",
              "description": "Select the Log Analytics workspace from dropdown list",
              "strongType": "omsWorkspace"
            }
          }
        },
        "policyDefinitions": [
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'nic-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'aa-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'pip-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'lb-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'nsg-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'kv-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'cognitive-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'dlanalytics-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'dlstore-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'eventHub-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'iotHub-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'logicApps-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'logicApps-Accounts-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'recoveryVault-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'search-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'serviceBus-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'sqlDB-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'sqlElasticPool-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'apiMgmt-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'appGw-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'batch-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'mySQL-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'postgreSQL-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'cdnEndpoints-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'cosmosDBs-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'dataFactory-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'firewall-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'powerBIEmbedded-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'streamAnalytics-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'expressRoutes-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'aci-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'acr-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'vnet-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'vm-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'vmss-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'vnetGW-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'aks-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'website-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'analysisService-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'eventGridTopic-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'eventGrid-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'hdInsight-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'redisCache-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'relay-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'signalR-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'trafficManager-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          },
          {
            "policyDefinitionId": "[resourceId('Microsoft.Authorization/policyDefinitions/', 'timeSeriesInsights-diag-policy')]",
            "parameters": {
              "logAnalytics": {
                "value": "[variables('logAnalytics')]"
              }
            }
          }
        ]
      }
    }
  ],
  "outputs": {

  }
}